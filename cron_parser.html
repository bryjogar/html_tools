<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron Parser & Generator - Homelab Playground</title>
	<link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        obsidian: {
                            bg: '#1e1e1e',       // Main background
                            pane: '#252526',     // Headers/Panels
                            border: '#3c3c3c',   // Borders
                            accent: '#7c3aed',   // Violet Primary
                            text: '#cccccc'      // Standard Text
                        }
                    },
                    fontFamily: {
                        mono: ['"Fira Code"', 'Consolas', 'Monaco', 'monospace'],
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1e1e; 
        }
        ::-webkit-scrollbar-thumb {
            background: #3c3c3c; 
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4b4b4b; 
        }
        
        /* Select styling override for dark mode */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden bg-obsidian-bg text-obsidian-text font-sans selection:bg-obsidian-accent selection:text-white">

    <header class="h-14 bg-obsidian-pane border-b border-obsidian-border flex items-center px-6 shrink-0 justify-between">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-clock text-obsidian-accent"></i>
            <h1 class="font-semibold text-lg tracking-wide">Cron Schedule Tool</h1>
        </div>
        <div class="text-xs text-gray-500 font-mono hidden sm:block">v2.0.0</div>
    </header>

    <main class="flex-grow overflow-y-auto p-6 flex flex-col items-center">
        <div class="w-full max-w-4xl flex flex-col gap-6">

            <div class="flex border-b border-obsidian-border">
                <button onclick="switchTab('parser')" id="tab-parser" class="px-6 py-3 text-sm font-medium border-b-2 border-obsidian-accent text-white focus:outline-none transition-colors">
                    <i class="fa-solid fa-glasses mr-2"></i>Parser
                </button>
                <button onclick="switchTab('generator')" id="tab-generator" class="px-6 py-3 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-300 focus:outline-none transition-colors">
                    <i class="fa-solid fa-sliders mr-2"></i>Generator
                </button>
            </div>

            <div id="view-parser" class="block animate-fade-in">
                <div class="bg-obsidian-pane border border-obsidian-border rounded-lg p-6 shadow-sm space-y-6">
                    
                    <div>
                        <label for="cronInput" class="block text-sm font-medium text-gray-400 mb-2">Paste Cron Schedule</label>
                        <div class="relative">
                            <input 
                                type="text" 
                                id="cronInput" 
                                class="w-full bg-[#111827] border border-obsidian-border rounded p-4 font-mono text-xl text-white placeholder-gray-700 focus:outline-none focus:border-obsidian-accent transition-colors"
                                placeholder="* * * * *" 
                                value="*/15 * * * *" 
                                oninput="parseInput()"
                                spellcheck="false"
                            >
                            <div id="parseStatusIcon" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-600">
                                <i class="fa-solid fa-check"></i>
                            </div>
                        </div>
                        <div id="parseError" class="text-red-400 text-xs mt-2 hidden font-mono">Invalid cron format</div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-[#1e1e1e] rounded border border-obsidian-border p-4">
                            <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-2">Interpretation</div>
                            <div id="humanOutput" class="text-obsidian-accent font-medium text-lg leading-relaxed">
                                Runs every 15 minutes
                            </div>
                        </div>

                        <div class="bg-[#1e1e1e] rounded border border-obsidian-border p-4">
                            <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-2">Next 3 Executions</div>
                            <div id="nextRuns" class="font-mono text-sm text-gray-300 space-y-1"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-generator" class="hidden">
                <div class="bg-obsidian-pane border border-obsidian-border rounded-lg p-6 shadow-sm space-y-8">
                    
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <div class="space-y-1">
                            <label class="text-xs font-semibold text-gray-500 uppercase">Minute</label>
                            <select id="genMin" onchange="updateGenerator()" class="w-full bg-[#111827] border border-obsidian-border rounded p-2 text-sm text-white focus:outline-none focus:border-obsidian-accent cursor-pointer">
                                <option value="*">Every (*)</option>
                                <option value="0">:00</option>
                                <option value="30">:30</option>
                                <option value="*/5">Every 5m</option>
                                <option value="*/15">Every 15m</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-semibold text-gray-500 uppercase">Hour</label>
                            <select id="genHour" onchange="updateGenerator()" class="w-full bg-[#111827] border border-obsidian-border rounded p-2 text-sm text-white focus:outline-none focus:border-obsidian-accent cursor-pointer">
                                <option value="*">Every (*)</option>
                                <option value="0">Midnight (0)</option>
                                <option value="9">9 AM</option>
                                <option value="12">Noon (12)</option>
                                <option value="17">5 PM (17)</option>
                                <option value="*/2">Every 2h</option>
                                <option value="9-17">9-5 Work</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-semibold text-gray-500 uppercase">Day</label>
                            <select id="genDay" onchange="updateGenerator()" class="w-full bg-[#111827] border border-obsidian-border rounded p-2 text-sm text-white focus:outline-none focus:border-obsidian-accent cursor-pointer">
                                <option value="*">Every (*)</option>
                                <option value="1">1st</option>
                                <option value="15">15th</option>
                                <option value="*/2">Every 2d</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-semibold text-gray-500 uppercase">Month</label>
                            <select id="genMonth" onchange="updateGenerator()" class="w-full bg-[#111827] border border-obsidian-border rounded p-2 text-sm text-white focus:outline-none focus:border-obsidian-accent cursor-pointer">
                                <option value="*">Every (*)</option>
                                <option value="*/3">Quarterly</option>
                                <option value="1">Jan</option>
                                <option value="6">Jun</option>
                                <option value="12">Dec</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-semibold text-gray-500 uppercase">Week Day</label>
                            <select id="genWeek" onchange="updateGenerator()" class="w-full bg-[#111827] border border-obsidian-border rounded p-2 text-sm text-white focus:outline-none focus:border-obsidian-accent cursor-pointer">
                                <option value="*">Every (*)</option>
                                <option value="1-5">Mon-Fri</option>
                                <option value="0">Sunday</option>
                                <option value="6">Saturday</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex flex-col items-center space-y-3 pt-4 border-t border-obsidian-border">
                        <div class="text-gray-500 text-xs font-mono">Generated Cron String</div>
                        
                        <button id="genOutputBtn" onclick="copyToClipboard()" class="group relative w-full max-w-md bg-[#111827] hover:bg-[#0f1523] border border-obsidian-border rounded-lg py-6 text-center transition-all cursor-pointer">
                            <span id="genOutputText" class="font-mono text-3xl text-obsidian-accent group-hover:text-white transition-colors">* * * * *</span>
                            
                            <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20 rounded-lg">
                                <span class="bg-obsidian-accent text-white text-xs px-2 py-1 rounded shadow">Click to Copy</span>
                            </div>
                        </button>
                    </div>

                </div>
            </div>

        </div>
    </main>

    <footer class="bg-obsidian-pane border-t border-obsidian-border py-2 text-center shrink-0 z-10">
        <a href="https://homelabplayground.com" class="text-gray-500 hover:text-obsidian-accent text-xs transition-colors font-sans no-underline">
            HomeLab Playground
        </a>
    </footer>

    <script>
        // --- LOGIC: Parser ---
        function parseInput() {
            const input = document.getElementById('cronInput').value.trim();
            const errorDiv = document.getElementById('parseError');
            const outputDiv = document.getElementById('humanOutput');
            const nextRunsDiv = document.getElementById('nextRuns');
            const statusIcon = document.getElementById('parseStatusIcon');
            
            const parts = input.split(/\s+/);
            
            if (parts.length < 5) {
                errorDiv.classList.remove('hidden');
                outputDiv.textContent = '...';
                nextRunsDiv.innerHTML = '<span class="text-gray-600 italic">Waiting for complete expression...</span>';
                statusIcon.innerHTML = '<i class="fa-solid fa-pen text-yellow-500"></i>';
                return;
            }

            errorDiv.classList.add('hidden');
            statusIcon.innerHTML = '<i class="fa-solid fa-check text-green-500"></i>';
            
            // 1. Human Readable Description
            outputDiv.textContent = describeCron(parts);

            // 2. Calculate Next Runs
            try {
                const dates = calculateNextRuns(input, 3);
                nextRunsDiv.innerHTML = dates.map(d => 
                    `<div class="flex justify-between items-center border-b border-white/5 py-1 last:border-0">
                        <span>${d.toLocaleDateString()}</span>
                        <span class="text-gray-500">${d.toLocaleTimeString()}</span>
                    </div>`
                ).join('');
            } catch (e) {
                nextRunsDiv.textContent = "Unable to calculate next dates.";
            }
        }

        function describeCron(parts) {
            const [min, hour, dom, mon, dow] = parts;
            
            // Simple heuristics for demo description
            if (min==='*' && hour==='*' && dom==='*' && mon==='*' && dow==='*') return "Runs every minute";
            if (min==='0' && hour==='0' && dom==='*' && mon==='*' && dow==='*') return "Runs every day at midnight";
            
            let desc = "Runs ";
            
            // Minute
            if (min.includes('/')) desc += `every ${min.split('/')[1]} minutes `;
            else if (min === '0') desc += `at minute 0 `;
            else if (min !== '*') desc += `at minute ${min} `;
            
            // Hour
            if (hour === '*') {} // implies every hour
            else if (hour.includes('-')) desc += `between hours ${hour} `;
            else if (hour.includes('/')) desc += `every ${hour.split('/')[1]} hours `;
            else desc += `past hour ${hour} `;

            // Date
            if (dom !== '*') desc += `on day ${dom} of the month `;
            if (mon !== '*') desc += `in month ${mon} `;
            if (dow !== '*') desc += `on day-of-week ${dow} `;

            if (desc === "Runs ") desc = "Runs every minute (default)";
            
            return desc;
        }

        // Lightweight "Next Run" calculator
        function calculateNextRuns(cronStr, count) {
            const parts = cronStr.split(/\s+/);
            let now = new Date();
            now.setMinutes(now.getMinutes() + 1);
            now.setSeconds(0);
            
            const results = [];
            let iterations = 0;

            while (results.length < count && iterations < 5000) {
                if (matches(now, parts)) {
                    results.push(new Date(now));
                }
                now.setMinutes(now.getMinutes() + 1);
                iterations++;
            }
            return results;
        }

        function matches(date, parts) {
            const [min, hour, dom, mon, dow] = parts;
            if (!checkField(date.getMinutes(), min)) return false;
            if (!checkField(date.getHours(), hour)) return false;
            if (!checkField(date.getDate(), dom)) return false;
            if (!checkField(date.getMonth() + 1, mon)) return false;
            if (!checkField(date.getDay(), dow)) return false; // 0-6
            return true;
        }

        function checkField(value, constraints) {
            if (constraints === '*') return true;
            if (constraints.includes(',')) return constraints.split(',').some(c => checkField(value, c));
            if (constraints.includes('/')) {
                const [range, step] = constraints.split('/');
                if (range !== '*' && !checkField(value, range)) return false;
                return value % parseInt(step) === 0;
            }
            if (constraints.includes('-')) {
                const [start, end] = constraints.split('-').map(Number);
                return value >= start && value <= end;
            }
            return parseInt(constraints) === value;
        }

        // --- LOGIC: Generator ---
        function updateGenerator() {
            const m = document.getElementById('genMin').value;
            const h = document.getElementById('genHour').value;
            const d = document.getElementById('genDay').value;
            const mo = document.getElementById('genMonth').value;
            const w = document.getElementById('genWeek').value;

            const cron = `${m} ${h} ${d} ${mo} ${w}`;
            const display = document.getElementById('genOutputText');
            
            display.textContent = cron;
        }

        function copyToClipboard() {
            const text = document.getElementById('genOutputText').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('genOutputBtn');
                const originalBorder = btn.className;
                
                // Visual feedback
                btn.classList.add('border-green-500', 'bg-green-500/10');
                const overlay = btn.querySelector('span.bg-obsidian-accent');
                if(overlay) {
                    overlay.classList.remove('bg-obsidian-accent');
                    overlay.classList.add('bg-green-600');
                    overlay.textContent = "Copied!";
                }

                setTimeout(() => {
                    btn.classList.remove('border-green-500', 'bg-green-500/10');
                    if(overlay) {
                        overlay.classList.add('bg-obsidian-accent');
                        overlay.classList.remove('bg-green-600');
                        overlay.textContent = "Click to Copy";
                    }
                }, 1500);
            });
        }

        // --- UI: Tabs ---
        function switchTab(tabId) {
            // Content
            document.getElementById('view-parser').classList.add('hidden');
            document.getElementById('view-generator').classList.add('hidden');
            document.getElementById(`view-${tabId}`).classList.remove('hidden');

            // Tabs Styling
            const btnParser = document.getElementById('tab-parser');
            const btnGenerator = document.getElementById('tab-generator');
            
            // Reset base classes
            const activeClass = ['border-obsidian-accent', 'text-white'];
            const inactiveClass = ['border-transparent', 'text-gray-500'];

            if(tabId === 'parser') {
                btnParser.classList.add(...activeClass);
                btnParser.classList.remove(...inactiveClass);
                
                btnGenerator.classList.add(...inactiveClass);
                btnGenerator.classList.remove(...activeClass);
            } else {
                btnGenerator.classList.add(...activeClass);
                btnGenerator.classList.remove(...inactiveClass);
                
                btnParser.classList.add(...inactiveClass);
                btnParser.classList.remove(...activeClass);
            }
        }

        // Initialize
        parseInput();
    </script>
</body>
</html>