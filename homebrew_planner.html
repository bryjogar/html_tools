<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homebrew Recipe Planner | Homelab Playground</title>
    
    <link rel="icon" type="image/png" href="https://homelabplayground.com/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        obsidian: {
                            bg: '#1e1e1e',      // Main background
                            pane: '#252526',    // Headers/Panels
                            border: '#3c3c3c',  // Borders
                            accent: '#7c3aed',  // Violet Primary
                            text: '#cccccc',    // Standard Text
                            input: '#2d2d2d'    // Input background
                        }
                    },
                    fontFamily: {
                        mono: ['"Fira Code"', 'Consolas', 'Monaco', 'monospace'],
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1e1e; 
        }
        ::-webkit-scrollbar-thumb {
            background: #3c3c3c; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }

        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        .tab-active {
            border-bottom: 2px solid #7c3aed;
            color: white;
        }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden bg-obsidian-bg text-obsidian-text font-sans selection:bg-obsidian-accent selection:text-white">

    <header class="h-14 bg-obsidian-pane border-b border-obsidian-border flex items-center justify-between px-4 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-beer-mug-empty text-obsidian-accent text-xl"></i>
            <h1 class="font-semibold text-white tracking-tight">BrewLab Planner</h1>
        </div>
        <button onclick="toggleMobileMenu()" class="md:hidden text-obsidian-text hover:text-white p-2">
            <i class="fa-solid fa-bars text-xl"></i>
        </button>
    </header>

    <div class="flex flex-1 overflow-hidden relative">
        
        <aside id="sidebar" class="absolute md:relative z-10 inset-y-0 left-0 w-64 bg-obsidian-pane border-r border-obsidian-border transform -translate-x-full md:translate-x-0 transition-transform duration-200 flex flex-col h-full">
            <div class="p-3 border-b border-obsidian-border flex justify-between items-center">
                <h2 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">My Recipes</h2>
                <button onclick="createNewRecipe()" class="w-8 h-8 rounded hover:bg-white/5 text-obsidian-accent transition-colors flex items-center justify-center" title="New Recipe">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
            
            <div class="p-2">
                <div class="relative">
                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-xs"></i>
                    <input type="text" id="searchInput" onkeyup="renderRecipeList()" placeholder="Filter..." class="w-full bg-obsidian-bg border border-obsidian-border rounded px-8 py-1.5 text-xs text-white focus:outline-none focus:border-obsidian-accent font-mono placeholder-gray-600">
                </div>
            </div>

            <div id="recipeList" class="flex-1 overflow-y-auto p-2 space-y-1">
                </div>
        </aside>

        <div id="sidebarOverlay" onclick="toggleMobileMenu()" class="fixed inset-0 bg-black/50 z-0 hidden md:hidden"></div>

        <main class="flex-1 flex flex-col min-w-0 bg-obsidian-bg h-full overflow-hidden">
            
            <div id="emptyState" class="hidden h-full flex flex-col items-center justify-center text-gray-500 gap-4 p-6 text-center">
                <div class="w-20 h-20 rounded-full bg-obsidian-pane flex items-center justify-center border border-obsidian-border">
                    <i class="fa-solid fa-flask text-3xl text-obsidian-accent/50"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-400">Select a recipe or start a new batch</h3>
                <button onclick="createNewRecipe()" class="px-4 py-2 bg-obsidian-accent hover:bg-violet-600 text-white rounded text-sm transition-colors">
                    Create New Recipe
                </button>
            </div>

            <div id="editorPanel" class="flex flex-col h-full">
                
                <div class="h-12 border-b border-obsidian-border flex items-center justify-between px-4 bg-obsidian-bg shrink-0">
                    <div class="flex items-center gap-2 overflow-hidden">
                        <span id="editModeIndicator" class="text-xs uppercase font-mono text-obsidian-accent border border-obsidian-accent/30 px-1.5 py-0.5 rounded">Draft</span>
                        <input type="text" id="recipeNameInput" class="bg-transparent border-none text-white font-semibold focus:outline-none focus:ring-0 w-full placeholder-gray-600 truncate" placeholder="Recipe Name...">
                    </div>
                    <div class="flex gap-2 shrink-0">
                        <button onclick="saveRecipe()" class="text-xs bg-obsidian-pane hover:bg-obsidian-accent text-white border border-obsidian-border hover:border-obsidian-accent px-3 py-1.5 rounded transition-all flex items-center gap-2">
                            <i class="fa-solid fa-save"></i> <span class="hidden sm:inline">Save</span>
                        </button>
                        <button onclick="deleteCurrentRecipe()" class="text-xs bg-obsidian-pane hover:bg-red-900/50 text-gray-400 hover:text-red-400 border border-obsidian-border hover:border-red-900 px-3 py-1.5 rounded transition-all">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-obsidian-pane border border-obsidian-border rounded p-3">
                            <label class="block text-xs text-gray-500 mb-1 font-mono uppercase">Style</label>
                            <input type="text" id="styleInput" class="w-full bg-obsidian-bg border border-obsidian-border rounded px-2 py-1 text-sm text-white focus:border-obsidian-accent focus:outline-none" placeholder="e.g. IPA">
                        </div>
                        <div class="bg-obsidian-pane border border-obsidian-border rounded p-3">
                            <label class="block text-xs text-gray-500 mb-1 font-mono uppercase">Batch Size (Gal)</label>
                            <input type="number" id="batchSizeInput" step="0.5" class="w-full bg-obsidian-bg border border-obsidian-border rounded px-2 py-1 text-sm text-white focus:border-obsidian-accent focus:outline-none font-mono" placeholder="5.0">
                        </div>
                        <div class="bg-obsidian-pane border border-obsidian-border rounded p-3 relative">
                            <label class="block text-xs text-gray-500 mb-1 font-mono uppercase">Orig. Gravity</label>
                            <input type="number" id="ogInput" step="0.001" oninput="calculateStats()" class="w-full bg-obsidian-bg border border-obsidian-border rounded px-2 py-1 text-sm text-white focus:border-obsidian-accent focus:outline-none font-mono text-obsidian-accent" placeholder="1.050">
                        </div>
                        <div class="bg-obsidian-pane border border-obsidian-border rounded p-3 relative">
                            <label class="block text-xs text-gray-500 mb-1 font-mono uppercase">Final Gravity</label>
                            <input type="number" id="fgInput" step="0.001" oninput="calculateStats()" class="w-full bg-obsidian-bg border border-obsidian-border rounded px-2 py-1 text-sm text-white focus:border-obsidian-accent focus:outline-none font-mono text-obsidian-accent" placeholder="1.010">
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-obsidian-pane to-obsidian-bg border border-obsidian-border rounded-lg p-4 flex flex-wrap gap-6 items-center shadow-lg">
                        <div>
                            <span class="block text-xs text-gray-500 font-mono uppercase">Est. ABV</span>
                            <span id="abvDisplay" class="text-xl font-bold text-white font-mono">0.0%</span>
                        </div>
                        <div class="h-8 w-px bg-obsidian-border"></div>
                        <div>
                            <span class="block text-xs text-gray-500 font-mono uppercase">Attenuation</span>
                            <span id="attDisplay" class="text-lg font-medium text-gray-300 font-mono">0%</span>
                        </div>
                        <div class="ml-auto text-xs text-gray-500 italic hidden sm:block">
                            *Auto-calculated from OG & FG
                        </div>
                    </div>

                    <div class="h-px bg-obsidian-border"></div>

                    <div class="space-y-6">
                        
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-semibold text-white flex items-center gap-2">
                                    <i class="fa-solid fa-wheat-awn text-yellow-600"></i> Fermentables
                                </h3>
                                <button onclick="addFermentableRow()" class="text-xs text-obsidian-accent hover:text-white transition-colors">+ Add Item</button>
                            </div>
                            <div class="bg-obsidian-pane border border-obsidian-border rounded overflow-hidden">
                                <table class="w-full text-left text-xs">
                                    <thead class="bg-white/5 font-mono text-gray-400">
                                        <tr>
                                            <th class="p-2 font-normal">Name</th>
                                            <th class="p-2 font-normal w-24">Amount (lb)</th>
                                            <th class="p-2 font-normal w-8"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="fermentablesList" class="divide-y divide-obsidian-border">
                                        </tbody>
                                </table>
                                <div id="noFermentables" class="p-4 text-center text-gray-500 text-xs italic">No fermentables added.</div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-semibold text-white flex items-center gap-2">
                                    <i class="fa-solid fa-seedling text-green-600"></i> Hops & Botanicals
                                </h3>
                                <button onclick="addHopRow()" class="text-xs text-obsidian-accent hover:text-white transition-colors">+ Add Item</button>
                            </div>
                            <div class="bg-obsidian-pane border border-obsidian-border rounded overflow-hidden">
                                <table class="w-full text-left text-xs">
                                    <thead class="bg-white/5 font-mono text-gray-400">
                                        <tr>
                                            <th class="p-2 font-normal">Name</th>
                                            <th class="p-2 font-normal w-24">Amount (oz)</th>
                                            <th class="p-2 font-normal w-24">Time (min)</th>
                                            <th class="p-2 font-normal w-8"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="hopsList" class="divide-y divide-obsidian-border">
                                        </tbody>
                                </table>
                                <div id="noHops" class="p-4 text-center text-gray-500 text-xs italic">No hops added.</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                                    <i class="fa-solid fa-bacterium text-pink-400"></i> Yeast
                                </h3>
                                <input type="text" id="yeastInput" class="w-full bg-obsidian-pane border border-obsidian-border rounded px-3 py-2 text-sm text-white focus:border-obsidian-accent focus:outline-none placeholder-gray-600" placeholder="Yeast Strain (e.g. US-05)">
                            </div>
                            <div>
                                <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                                    <i class="fa-solid fa-temperature-half text-blue-400"></i> Ferm. Temp (Â°F)
                                </h3>
                                <input type="number" id="tempInput" class="w-full bg-obsidian-pane border border-obsidian-border rounded px-3 py-2 text-sm text-white focus:border-obsidian-accent focus:outline-none placeholder-gray-600 font-mono" placeholder="68">
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-sm font-semibold text-white mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-clipboard text-gray-400"></i> Process Notes
                        </h3>
                        <textarea id="notesInput" class="w-full h-32 bg-obsidian-pane border border-obsidian-border rounded p-3 text-sm text-gray-300 focus:border-obsidian-accent focus:outline-none font-mono leading-relaxed" placeholder="Mash steps, boil notes, tasting notes..."></textarea>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <footer class="bg-obsidian-pane border-t border-obsidian-border py-3 text-center shrink-0 z-10 flex flex-col md:flex-row justify-center items-center gap-3">
        <a href="https://homelabplayground.com" class="text-gray-500 hover:text-violet-400 text-xs transition-colors font-sans no-underline">
            HomeLab Playground
        </a>
        <span class="hidden md:block text-obsidian-border mx-1">|</span>
        <a href="https://www.buymeacoffee.com/bryjogar" target="_blank" class="inline-flex items-center px-3 py-1 bg-obsidian-accent hover:bg-violet-600 text-white text-xs font-sans rounded-full transition-colors no-underline">
            <i class="fa-solid fa-mug-hot mr-1.5"></i>
            <span>Support The Tools</span>
        </a>
    </footer>

    <script>
        // State
        let recipes = [];
        let currentRecipeId = null;

        // Constants
        const STORAGE_KEY = 'homelab_brew_recipes';

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            loadRecipes();
            renderRecipeList();
            
            if (recipes.length > 0) {
                selectRecipe(recipes[0].id);
            } else {
                showEmptyState();
            }
        });

        // --- Core Data Functions ---

        function loadRecipes() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                recipes = JSON.parse(stored);
            } else {
                // Seed some data if empty
                recipes = []; 
            }
        }

        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(recipes));
        }

        function createNewRecipe() {
            const newRecipe = {
                id: Date.now().toString(),
                name: "New Brew",
                style: "",
                batchSize: 5.0,
                og: "",
                fg: "",
                yeast: "",
                temp: "",
                fermentables: [],
                hops: [],
                notes: "",
                lastUpdated: Date.now()
            };
            recipes.unshift(newRecipe); // Add to top
            saveToStorage();
            renderRecipeList();
            selectRecipe(newRecipe.id);
            
            // Close mobile menu if open
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (!sidebar.classList.contains('-translate-x-full')) {
                toggleMobileMenu();
            }
        }

        function selectRecipe(id) {
            currentRecipeId = id;
            const recipe = recipes.find(r => r.id === id);
            
            if (!recipe) return;

            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('editorPanel').classList.remove('hidden');

            // Populate Fields
            document.getElementById('recipeNameInput').value = recipe.name;
            document.getElementById('styleInput').value = recipe.style || '';
            document.getElementById('batchSizeInput').value = recipe.batchSize || '';
            document.getElementById('ogInput').value = recipe.og || '';
            document.getElementById('fgInput').value = recipe.fg || '';
            document.getElementById('yeastInput').value = recipe.yeast || '';
            document.getElementById('tempInput').value = recipe.temp || '';
            document.getElementById('notesInput').value = recipe.notes || '';

            // Render Ingredients
            renderFermentables(recipe.fermentables);
            renderHops(recipe.hops);
            
            // Calc Stats
            calculateStats();

            // Highlight in list
            renderRecipeList();
        }

        function saveRecipe() {
            if (!currentRecipeId) return;

            const index = recipes.findIndex(r => r.id === currentRecipeId);
            if (index === -1) return;

            // Gather Data
            const updatedRecipe = {
                ...recipes[index],
                name: document.getElementById('recipeNameInput').value || "Untitled",
                style: document.getElementById('styleInput').value,
                batchSize: document.getElementById('batchSizeInput').value,
                og: document.getElementById('ogInput').value,
                fg: document.getElementById('fgInput').value,
                yeast: document.getElementById('yeastInput').value,
                temp: document.getElementById('tempInput').value,
                notes: document.getElementById('notesInput').value,
                fermentables: getFermentablesFromDOM(),
                hops: getHopsFromDOM(),
                lastUpdated: Date.now()
            };

            recipes[index] = updatedRecipe;
            saveToStorage();
            renderRecipeList();
            
            // Simple visual feedback
            const saveBtn = document.querySelector('button[onclick="saveRecipe()"]');
            const originalHTML = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fa-solid fa-check"></i> <span class="hidden sm:inline">Saved</span>';
            setTimeout(() => {
                saveBtn.innerHTML = originalHTML;
            }, 1500);
        }

        function deleteCurrentRecipe() {
            if (!currentRecipeId) return;
            if(!confirm("Are you sure you want to delete this recipe?")) return;

            recipes = recipes.filter(r => r.id !== currentRecipeId);
            saveToStorage();
            renderRecipeList();
            
            if (recipes.length > 0) {
                selectRecipe(recipes[0].id);
            } else {
                showEmptyState();
            }
        }

        // --- Rendering ---

        function showEmptyState() {
            document.getElementById('emptyState').classList.remove('hidden');
            document.getElementById('editorPanel').classList.add('hidden');
            currentRecipeId = null;
        }

        function renderRecipeList() {
            const listEl = document.getElementById('recipeList');
            const search = document.getElementById('searchInput').value.toLowerCase();
            
            listEl.innerHTML = '';

            const filtered = recipes.filter(r => r.name.toLowerCase().includes(search) || (r.style && r.style.toLowerCase().includes(search)));

            filtered.forEach(r => {
                const isActive = r.id === currentRecipeId;
                const activeClass = isActive ? 'bg-obsidian-accent/10 border-obsidian-accent' : 'border-transparent hover:bg-white/5';
                const textClass = isActive ? 'text-white' : 'text-gray-400';

                const div = document.createElement('div');
                div.className = `p-3 rounded border cursor-pointer transition-colors ${activeClass}`;
                div.onclick = () => {
                    selectRecipe(r.id);
                    // Close mobile menu if open
                    if(window.innerWidth < 768) {
                        toggleMobileMenu();
                    }
                };

                const dateStr = new Date(r.lastUpdated).toLocaleDateString();

                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <h4 class="font-medium text-sm truncate pr-2 ${isActive ? 'text-obsidian-accent' : 'text-gray-200'}">${r.name}</h4>
                        <span class="text-[10px] text-gray-600 font-mono shrink-0">${dateStr}</span>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <span class="text-xs ${textClass} truncate">${r.style || 'No Style'}</span>
                        ${r.og ? `<span class="text-[10px] font-mono text-gray-500 bg-black/20 px-1 rounded">OG:${r.og}</span>` : ''}
                    </div>
                `;
                listEl.appendChild(div);
            });
        }

        // --- Ingredient Logic ---

        function renderFermentables(items) {
            const tbody = document.getElementById('fermentablesList');
            const emptyMsg = document.getElementById('noFermentables');
            tbody.innerHTML = '';
            
            if (!items || items.length === 0) {
                emptyMsg.classList.remove('hidden');
                return;
            }
            emptyMsg.classList.add('hidden');

            items.forEach((item, idx) => {
                const tr = document.createElement('tr');
                tr.className = 'group hover:bg-white/5 transition-colors';
                tr.innerHTML = `
                    <td class="p-1">
                        <input type="text" value="${item.name}" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 placeholder-gray-600" placeholder="Ingredient Name">
                    </td>
                    <td class="p-1">
                        <input type="number" step="0.1" value="${item.amount}" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 font-mono text-right" placeholder="0">
                    </td>
                    <td class="p-1 text-center">
                        <button onclick="removeRow(this)" class="text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fa-solid fa-times"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderHops(items) {
            const tbody = document.getElementById('hopsList');
            const emptyMsg = document.getElementById('noHops');
            tbody.innerHTML = '';
            
            if (!items || items.length === 0) {
                emptyMsg.classList.remove('hidden');
                return;
            }
            emptyMsg.classList.add('hidden');

            items.forEach((item, idx) => {
                const tr = document.createElement('tr');
                tr.className = 'group hover:bg-white/5 transition-colors';
                tr.innerHTML = `
                    <td class="p-1">
                        <input type="text" value="${item.name}" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 placeholder-gray-600" placeholder="Hop Name">
                    </td>
                    <td class="p-1">
                        <input type="number" step="0.1" value="${item.amount}" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 font-mono text-right" placeholder="0">
                    </td>
                    <td class="p-1">
                        <input type="number" step="1" value="${item.time}" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 font-mono text-right" placeholder="60">
                    </td>
                    <td class="p-1 text-center">
                        <button onclick="removeRow(this)" class="text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fa-solid fa-times"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function addFermentableRow() {
            document.getElementById('noFermentables').classList.add('hidden');
            const tbody = document.getElementById('fermentablesList');
            const tr = document.createElement('tr');
            tr.className = 'group hover:bg-white/5 transition-colors';
            tr.innerHTML = `
                <td class="p-1">
                    <input type="text" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 border-b border-transparent focus:border-obsidian-accent placeholder-gray-600" placeholder="Ingredient Name">
                </td>
                <td class="p-1">
                    <input type="number" step="0.1" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 font-mono text-right border-b border-transparent focus:border-obsidian-accent" placeholder="0">
                </td>
                <td class="p-1 text-center">
                    <button onclick="removeRow(this)" class="text-gray-600 hover:text-red-400 opacity-100 transition-opacity"><i class="fa-solid fa-times"></i></button>
                </td>
            `;
            tbody.appendChild(tr);
            tr.querySelector('input').focus();
        }

        function addHopRow() {
            document.getElementById('noHops').classList.add('hidden');
            const tbody = document.getElementById('hopsList');
            const tr = document.createElement('tr');
            tr.className = 'group hover:bg-white/5 transition-colors';
            tr.innerHTML = `
                <td class="p-1">
                    <input type="text" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 border-b border-transparent focus:border-obsidian-accent placeholder-gray-600" placeholder="Hop Name">
                </td>
                <td class="p-1">
                    <input type="number" step="0.1" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 font-mono text-right border-b border-transparent focus:border-obsidian-accent" placeholder="0">
                </td>
                <td class="p-1">
                    <input type="number" step="1" class="w-full bg-transparent text-sm text-gray-300 focus:text-white focus:outline-none p-1 font-mono text-right border-b border-transparent focus:border-obsidian-accent" placeholder="60">
                </td>
                <td class="p-1 text-center">
                    <button onclick="removeRow(this)" class="text-gray-600 hover:text-red-400 opacity-100 transition-opacity"><i class="fa-solid fa-times"></i></button>
                </td>
            `;
            tbody.appendChild(tr);
            tr.querySelector('input').focus();
        }

        function removeRow(btn) {
            const row = btn.closest('tr');
            const tbody = row.parentElement;
            row.remove();
            
            // Check if empty to show message
            if(tbody.id === 'fermentablesList' && tbody.children.length === 0) {
                document.getElementById('noFermentables').classList.remove('hidden');
            }
            if(tbody.id === 'hopsList' && tbody.children.length === 0) {
                document.getElementById('noHops').classList.remove('hidden');
            }
        }

        function getFermentablesFromDOM() {
            const rows = document.querySelectorAll('#fermentablesList tr');
            const data = [];
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                if(inputs[0].value.trim() !== '') {
                    data.push({
                        name: inputs[0].value,
                        amount: inputs[1].value
                    });
                }
            });
            return data;
        }

        function getHopsFromDOM() {
            const rows = document.querySelectorAll('#hopsList tr');
            const data = [];
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                if(inputs[0].value.trim() !== '') {
                    data.push({
                        name: inputs[0].value,
                        amount: inputs[1].value,
                        time: inputs[2].value
                    });
                }
            });
            return data;
        }

        // --- Calculations ---

        function calculateStats() {
            const og = parseFloat(document.getElementById('ogInput').value);
            const fg = parseFloat(document.getElementById('fgInput').value);
            
            let abv = 0;
            let att = 0;

            if (!isNaN(og) && !isNaN(fg) && og > fg) {
                // Standard ABV Formula: (OG - FG) * 131.25
                abv = (og - fg) * 131.25;
                
                // Attenuation: (OG - FG) / (OG - 1)
                att = ((og - fg) / (og - 1)) * 100;
            }

            document.getElementById('abvDisplay').textContent = abv > 0 ? abv.toFixed(1) + '%' : '0.0%';
            document.getElementById('attDisplay').textContent = att > 0 ? Math.round(att) + '%' : '0%';
        }

        // --- UI Utils ---

        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

    </script>
</body>
</html>