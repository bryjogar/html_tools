! Aruba AOS-CX Running Configuration Template
! -------------------------------------------

! System Initialization
! ---------------------
hostname {{ hostname }}

! Admin User Configuration (Plaintext password required for initial template)
! 'group administrators' gives full privileges (Privilege 15 equivalent)
user {{ admin_username }} group administrators password plaintext {{ admin_password }}

! Network Management Settings
! ---------------------------
! Set Timezone (Example: user-defined-zone "CST" -6 0)
clock timezone {{ timezone_region }}
ntp server {{ ntp_server_ip }}

! DNS for name resolution
ip dns server-address {{ dns_server_ip }}
ip domain-name {{ domain_name }}

! Global Layer 2 Settings
! -----------------------
! Enable IGMP Snooping globally (Prevents multicast flooding)
ip igmp snooping

! Spanning Tree (MSTP is default, Rapid-PVST often preferred for compatibility)
spanning-tree mode rpvnst
spanning-tree
spanning-tree priority {{ stp_priority_default }}

! VLAN Configuration
! ------------------
vlan 1
 description DEFAULT_VLAN

vlan {{ management_vlan_id }}
 description {{ management_vlan_name }}

vlan {{ data_vlan_id }}
 description {{ data_vlan_name }}

vlan {{ voice_vlan_id }}
 description {{ voice_vlan_name }}
 ! This command triggers LLDP-MED for phones automatically
 voice

vlan {{ guest_vlan_id }}
 description {{ guest_vlan_name }}

! Layer 3 Interfaces (SVIs)
! -------------------------
! Management Interface (In-Band)
interface vlan {{ management_vlan_id }}
 description MANAGEMENT_SVI
 ip address {{ switch_management_ip }}/{{ subnet_mask_cidr }}
 ! AOS-CX requires 'no shutdown' on SVIs
 no shutdown

! Default Gateway (If Layer 2 only)
ip route 0.0.0.0/0 {{ gateway_ip_address }}

! Interface Configuration: User Ports (1/1/1 - 1/1/48)
! ----------------------------------------------------
interface {{ user_access_ports_range }}
 description {{ user_port_naming_convention }}
 no shutdown
 
 ! Configure as Access Port
 no routing
 vlan access {{ data_vlan_id }}
 
 ! Voice VLAN (Tagged automatically via LLDP-MED)
 vlan voice {{ voice_vlan_id }}
 
 ! Security & Edge Settings
 spanning-tree admin-edge-port
 spanning-tree bpdu-guard
 
 ! PoE Priority (Critical for phones)
 power-over-ethernet priority critical
 
 ! Loop Protection (Optional but recommended)
 loop-protect
 loop-protect action tx-disable
 exit

! Interface Configuration: Uplinks (Trunks)
! -----------------------------------------
interface {{ uplink_ports_range }}
 description {{ uplink_description }}
 no shutdown
 no routing
 
 ! Trunking Mode
 vlan trunk native 1
 vlan trunk allowed {{ management_vlan_id }},{{ data_vlan_id }},{{ voice_vlan_id }},{{ guest_vlan_id }}
 
 ! Uplinks are NOT edge ports
 no spanning-tree admin-edge-port
 exit

! Security & Remote Access (SSH/HTTPS)
! ------------------------------------
! Enable SSH
ssh server vrf default
ssh server listen

! Disable Telnet (Insecure)
no telnet server

! Web UI Access
https-server vrf default

! Final Save
! ----------
! copy running-config startup-config