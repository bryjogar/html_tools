! Netgear M-Series (AV Line) Configuration Template
! -------------------------------------------------

! System Initialization
! ---------------------
hostname {{ hostname }}

! Set Time Zone and SNTP (Critical for logs)
clock timezone {{ timezone_region }} {{ timezone_offset }}
sntp server {{ ntp_server_ip }}
sntp interval 60
sntp unicast-client enable

! Administration & Security
! -------------------------
! Create Admin User
username {{ admin_username }} password {{ admin_password }} privilege 15

! Enable SSH and Disable Telnet
ip ssh server enable
no ip telnet server enable

! Enable HTTP/HTTPS for the AV Web Interface (The nice GUI)
ip http server enable
ip http secure-server enable

! Global AV / Multicast Settings (Crucial for M-Series)
! -----------------------------------------------------
! Enable IGMP Snooping Globally to handle AV-over-IP streams
ip igmp snooping

! VLAN Database Configuration
! ---------------------------
vlan database
 vlan {{ management_vlan_id }} name {{ management_vlan_name }}
 vlan {{ audio_vlan_id }} name {{ audio_vlan_name }}
 vlan {{ video_vlan_id }} name {{ video_vlan_name }}
 vlan {{ control_vlan_id }} name {{ control_vlan_name }}
 exit

! VLAN Interface Configuration (Layer 3 SVIs)
! -------------------------------------------
! Management Interface
interface vlan {{ management_vlan_id }}
 ip address {{ switch_management_ip }} {{ subnet_mask }}
 no shutdown
 exit

! AV VLAN IGMP Configuration (The "Secret Sauce" for AV)
! ------------------------------------------------------
! Configure Video VLAN for multicast (e.g., NDI, Crestron NVX)
interface vlan {{ video_vlan_id }}
 ! Enable IGMP Snooping on this VLAN
 ip igmp snooping enable
 ! Enable Querier (Required if no core router is doing it)
 ip igmp snooping querier
 ! Fast Leave (Essential for fast video switching)
 ip igmp snooping fast-leave
 ! Suppression (Prevents multicast flooding to all ports)
 ip igmp snooping report-suppression
 exit

! Configure Audio VLAN (e.g., Dante, AES67)
interface vlan {{ audio_vlan_id }}
 ip igmp snooping enable
 ip igmp snooping querier
 exit

! Interface Configuration (AV Endpoints)
! --------------------------------------
! Ports connecting to Cameras, Encoders, Decoders
interface range {{ av_endpoint_ports_range }}
 description {{ av_endpoints_description }}
 
 ! Set VLAN membership (Untagged/Access)
 vlan pvid {{ video_vlan_id }}
 vlan participation include {{ video_vlan_id }}
 vlan participation exclude 1
 
 ! PoE Settings (Power up devices)
 poe
 poe priority critical
 
 ! Enable Jumbo Frames if using raw video (SDVoE)
 mtu 9000
 exit

! Interface Configuration (Control/Data Ports)
! --------------------------------------------
interface range {{ control_ports_range }}
 description {{ control_ports_description }}
 vlan pvid {{ control_vlan_id }}
 vlan participation include {{ control_vlan_id }}
 vlan participation exclude 1
 exit

! Interface Configuration (Uplinks/Trunks)
! ----------------------------------------
interface range {{ uplink_ports_range }}
 description {{ uplink_description }}
 
 ! Trunking Mode (Tagging all VLANs)
 vlan participation include {{ management_vlan_id }}
 vlan tagging {{ management_vlan_id }}
 
 vlan participation include {{ video_vlan_id }}
 vlan tagging {{ video_vlan_id }}
 
 vlan participation include {{ audio_vlan_id }}
 vlan tagging {{ audio_vlan_id }}
 
 ! Uplinks usually exclude default VLAN 1 untagged
 vlan participation exclude 1
 exit

! IP Routing & Gateway
! --------------------
! If L2 mode (Gateway)
ip default-gateway {{ gateway_ip_address }}

! If L3 mode (Routing enabled)
! ip route 0.0.0.0 0.0.0.0 {{ next_hop_gateway_ip }}

! Final Save
! ----------
exit
write memory